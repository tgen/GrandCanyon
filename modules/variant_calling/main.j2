{% from 'modules/variant_calling/deepvariant.j2' import deepvariant with context %}
{% from 'modules/variant_calling/cutesv.j2' import cutesv with context %}
{% from 'modules/variant_calling/longshot.j2' import longshot with context %}
{% from 'modules/variant_calling/sniffles.j2' import sniffles with context %}
{% from 'modules/variant_calling/pbsv.j2' import pbsv with context %}
{% from 'modules/variant_calling/severus.j2' import severus with context %}
{% from 'modules/variant_calling/dysgu.j2' import dysgu with context %}
{% from 'modules/variant_calling/cytocad.j2' import cytocad with context %}
{% from 'modules/variant_calling/hifi_cnv.j2' import hifi_cnv with context %}

{%- macro constitutional_variant_calling(samples) %}

{%- for sample in samples.values() if sample.gltype in ('exome', 'genome', 'genomephased') %}

  {%- if sample.subGroup|lower != 'tumor' %}
    {% if sample.gltype in 'exome' %}
        {% set taskPrefix = 'Exome' %}
    {% elif sample.gltype in 'genome' %}
        {% set taskPrefix = 'Genome' %}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_snp_indel_caller_deepvariant"]|default(true) %}
      {{- deepvariant(sample) }}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_snp_indel_caller_longshot"]|default(false) %}
      {{- longshot(sample) }}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_structural_caller_cutesv"]|default(true) %}
      {{- cutesv(sample) }}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_structural_caller_sniffles"]|default(true) %}
      {{- sniffles(sample) }}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_structural_caller_severus"]|default(true) %}
      {{- severus(sample) }}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_structural_caller_dysgu"]|default(true) %}
      {{- dysgu(sample) }}
    {% endif %}

    {% if tasks[taskPrefix+"_variant_calling_cna_caller_cytocad"]|default(true) %}
      {{- cytocad(sample) }}
    {% endif %}

    {% if sample.rgpl in ('PACBIO') %}
      {% if tasks[taskPrefix+"_variant_calling_structural_caller_pbsv"]|default(false) %}
        {{- pbsv(sample) }}
      {% endif %}

      {% if tasks[taskPrefix+"_variant_calling_cna_caller_hificnv"]|default(true) %}
        {{- hifi_cnv(sample) }}
      {% endif %}
    {% endif %}
  {% endif %}

{% endfor %}

{% endmacro %}

